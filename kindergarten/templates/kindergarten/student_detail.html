{% extends 'kindergarten/base.html' %}

{% block title %}Ученик: {{ student.student_fio }}{% endblock %}

{% block content %}
<h1>{{ student.student_fio }}</h1>

<div style="display: flex; gap: 20px; margin-bottom: 30px;">
    {% if user.groups.all.0.name == 'Заведующие' or user.is_superuser %}
    <a href="{% url 'student_edit' student.pk %}" class="btn btn-warning">Редактировать</a>
    <a href="{% url 'student_delete' student.pk %}" class="btn btn-danger">Удалить</a>
    <a href="{% url 'student_list' %}" class="btn btn-secondary">Назад к списку</a>
    {% elif user.groups.all.0.name == 'Родители' %}
        <a href="{% url 'home' %}" class="btn btn-secondary">Назад</a>
    {% endif %}
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
    <div>
        <h2>Основная информация</h2>
        <table class="info-table">
            <tr><th>Дата рождения:</th><td>{{ student.student_birthday }}</td></tr>
            <tr><th>Дата поступления:</th><td>{{ student.student_date_in }}</td></tr>
            <tr><th>Дата выпуска:</th><td>{{ student.student_date_out|default:"-" }}</td></tr>
            <tr><th>Группа:</th><td>{{ student.group.group_name }}</td></tr>
            <tr><th>Возрастная категория:</th><td>{{ student.group.group_category }}</td></tr>
            <tr><th>Воспитатель:</th><td>{{ student.group.teacher.teacher_fio }}</td></tr>
        </table>
    </div>
    
    <div>
        <h2>Родители</h2>
        {% if parents %}
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>ФИО</th>
                    <th>Телефон</th>
                    <th>Родство</th>
                </tr>
            </thead>
            <tbody>
                {% for rel in parents %}
                <tr>
                    <td>{{ rel.parent.parent_fio }}</td>
                    <td>{{ rel.parent.parent_number }}</td>
                    <td>{{ rel.relationship_type }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>Родители не указаны</p>
        {% endif %}
        
        <h2 style="margin-top: 30px;">Посещаемость (последние 10 записей)</h2>
        {% if attendance %}
        <table>
            <tr>
                <th>Дата</th>
                <th>Статус</th>
            </tr>
            {% for att in attendance %}
            <tr>
                <td>{{ att.attendance_date }}</td>
                <td>
                    {% if att.attendance_status %}
                    <span style="color: green;">Присутствовал</span>
                    {% else %}
                    <span style="color: red;">Отсутствовал</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>Нет записей о посещаемости</p>
        {% endif %}
    </div>
</div>
{% endblock %}