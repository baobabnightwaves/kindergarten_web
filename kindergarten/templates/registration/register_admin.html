{% extends 'kindergarten/base.html' %}

{% block title %}Создание нового пользователя{% endblock %}

{% block extra_css %}
<style>
.form-container { max-width: 800px; margin: 0 auto; padding: 1rem; }
.form-card { border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-radius: 8px; }
.form-header { background: #28a745; color: white; padding: 1rem 1.5rem; border-radius: 8px 8px 0 0; }
.form-header h4 { margin: 0; font-size: 1.1rem; font-weight: 500; }
.form-body { padding: 1.5rem; }
.form-body > form > div:not(.btn-actions), .form-body > form > .row { margin-bottom: 1rem; }
.form-body label { font-size: 0.9rem; font-weight: 500; color: #495057; margin-bottom: 0.3rem; display: block; }
.form-body input[type="text"], .form-body input[type="date"], .form-body input[type="email"], .form-body input[type="tel"], .form-body input[type="password"], .form-body select, .form-body textarea { font-size: 0.9rem; padding: 0.5rem 0.75rem; border: 1px solid #ced4da; border-radius: 4px; width: 100%; transition: border-color 0.15s; }
.form-body input:focus, .form-body select:focus, .form-body textarea:focus { border-color: #28a745; outline: none; box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.1); }
.btn-compact { padding: 0.5rem 1.5rem; font-size: 0.9rem; border-radius: 4px; font-weight: 500; }
.btn-actions { padding-top: 1.5rem; margin-top: 1.5rem; border-top: 1px solid #e9ecef; display: flex; gap: 0.75rem; }
.row-compact { margin-left: -0.5rem; margin-right: -0.5rem; }
.row-compact > [class*='col-'] { padding-left: 0.5rem; padding-right: 0.5rem; }
.error-text { font-size: 0.8rem; color: #dc3545; margin-top: 0.25rem; }
.role-card { cursor: pointer; transition: all 0.2s ease; border: 2px solid #e9ecef; border-radius: 4px; margin-bottom: 0.5rem; }
.role-card:hover { transform: translateY(-2px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.role-card .form-check-input { margin-top: 0.25rem; }
.role-card.border-primary, .role-card.border-success, .role-card.border-warning, .role-card.border-danger { border-width: 2px; }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="card form-card">
        <div class="form-header">
            <h4>Создание нового пользователя</h4>
        </div>
        <div class="form-body">
                <form method="post">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="alert alert-danger">
                        <h6>Ошибки в форме:</h6>
                        <ul class="mb-0">
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ field.label }}: {{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    
                        <div>
                            <label for="{{ form.username.id_for_label }}">Имя пользователя</label>
                            {{ form.username }}
                            {% if form.username.errors %}
                            <div class="error-text">{{ form.username.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label for="full_name">ФИО</label>
                            <input type="text" class="form-control" id="full_name" name="full_name" 
                                   required placeholder="Иванов Иван Иванович">
                        </div>
                    
                        <div class="row row-compact">
                            <div class="col-md-6">
                                <div>
                                    <label for="{{ form.password1.id_for_label }}">Пароль</label>
                                    {{ form.password1 }}
                                    {% if form.password1.errors %}
                                    <div class="error-text">{{ form.password1.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div>
                                    <label for="{{ form.password2.id_for_label }}">Подтверждение пароля</label>
                                    {{ form.password2 }}
                                    {% if form.password2.errors %}
                                    <div class="error-text">{{ form.password2.errors }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    
                        <div class="row row-compact">
                            <div class="col-md-6">
                                <div>
                                    <label for="phone">Номер телефона</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" 
                                           required placeholder="+7-999-123-45-67">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div>
                                    <label for="email">Email</label>
                                    <input type="email" class="form-control" id="email" name="email" 
                                           placeholder="ivanov@example.com">
                                </div>
                            </div>
                        </div>
                    
                    <div>
                        <label>Роль пользователя</label>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card h-100 role-card" data-role="parent">
                                <div class="card-body text-center">
                                    <div class="mb-3">
                                        </div>
                                    <h5>Родитель</h5>
                                    <p class="small text-muted">
                                        Просмотр информации о своем ребенке
                                    </p>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="role" 
                                               id="role_parent" value="parent">
                                        <label class="form-check-label" for="role_parent">
                                            Выбрать
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card h-100 role-card" data-role="teacher">
                                <div class="card-body text-center">
                                    <div class="mb-3">
                                        </div>
                                    <h5>Воспитатель</h5>
                                    <p class="small text-muted">
                                        Отметка посещаемости, управление своей группой
                                    </p>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="role" 
                                               id="role_teacher" value="teacher">
                                        <label class="form-check-label" for="role_teacher">
                                            Выбрать
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card h-100 role-card" data-role="director">
                                <div class="card-body text-center">
                                    <div class="mb-3">
                                        </div>
                                    <h5>Заведующий</h5>
                                    <p class="small text-muted">
                                        Полный доступ ко всем данным (администратор сада)
                                    </p>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="role" 
                                               id="role_director" value="director">
                                        <label class="form-check-label" for="role_director">
                                            Выбрать
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card h-100 role-card" data-role="superuser">
                                <div class="card-body text-center">
                                    <div class="mb-3">
                                        </div>
                                    <h5>Суперпользователь</h5>
                                    <p class="small text-muted">
                                        Полный доступ + управление пользователями
                                    </p>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="role" 
                                               id="role_superuser" value="superuser">
                                        <label class="form-check-label" for="role_superuser">
                                            Выбрать
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    </div>
                    
                    <!-- Кнопки действий -->
                    <div class="btn-actions">
                        <button type="submit" class="btn btn-primary btn-compact">
                            Создать пользователя
                        </button>
                        <a href="{% url 'user_management' %}" class="btn btn-secondary btn-compact">
                            Назад к списку
                        </a>
                    </div>
                </form>
            </div>
        </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const roleCards = document.querySelectorAll('.role-card');
    const roleInputs = document.querySelectorAll('input[name="role"]');
    
    // Подсветка выбранной роли
    roleInputs.forEach(input => {
        input.addEventListener('change', function() {
            roleCards.forEach(card => {
                card.classList.remove('border-primary', 'border-success', 'border-warning', 'border-danger', 'shadow');
            });
            
            const selectedCard = document.querySelector(`.role-card[data-role="${this.value}"]`);
            if (selectedCard) {
                if (this.value === 'parent') {
                    selectedCard.classList.add('border-primary');
                } else if (this.value === 'teacher') {
                    selectedCard.classList.add('border-success');
                } else if (this.value === 'director') {
                    selectedCard.classList.add('border-warning');
                } else if (this.value === 'superuser') {
                    selectedCard.classList.add('border-danger');
                }
                selectedCard.classList.add('shadow');
            }
        });
    });
    
    // Клик по всей карточке для выбора роли
    roleCards.forEach(card => {
        card.addEventListener('click', function(e) {
            // Получаем роль из атрибута data-role
            const role = this.getAttribute('data-role');
            // Находим соответствующий radio input
            const radioInput = document.getElementById(`role_${role}`);
            if (radioInput) {
                radioInput.checked = true;
                radioInput.dispatchEvent(new Event('change'));
            }
        });
    });
    
    // Инициализация подсветки (выбираем родителя по умолчанию)
    document.getElementById('role_parent').checked = true;
    document.getElementById('role_parent').dispatchEvent(new Event('change'));
});
</script>
{% endblock %}
